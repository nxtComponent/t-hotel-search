<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../paper-dialog/paper-dialog.html">
<link rel="import" href="../paper-item/paper-item.html">
<link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../iron-media-query/iron-media-query.html">
<link rel="import" href="../paper-listbox/paper-listbox.html">
<link rel="import" href="t-input-date-picker/t-input-date-picker.html">
<link rel="import" href="t-search-style.html">
<link rel="import" href="choice-card.html">
<link rel="import" href="t-autosuggest.html">


<!--
This component is a form that fires an event with search request object on successfull submission. 

There are two  properties that are required to run this form which initialize the location autosuggest. These are
`data-url`, `token-response`.

To preselect some value in the form, pass the value of the property while initiating t-search.

Example:

    <t-search 
        id="searchView" 
        data-url="e.g BASEURL/api/content/autosuggest/" 
        token-response="{{tokenResponse}}">
    </t-search>

### Styling
Custom property                         | Description                                      | Default
----------------------------------------|--------------------------------------------------|-------------
  --outer-container-color               |  Background color of outer container             |     #424D51
  --search-button-color                 |  Color for search button                         |     #4CB050
  --dropdown-element-link-color         |  Color for Link in travellers Drop down          |     #4CB050
  --button-color-for-rooms              |  Color for buttons availabel in travellers form  |     #478BD7
  --border-color-for-cards              |  Color for borders of cards                      |     lightgray
  --background-color-for-traveller-card |  Background color for travellers form            |     white 
  --color-for-calendar-dates            |  Color for calendar selectable dates             |     #4CB050
  --color-for-calendar-background       |  Background color for calendar                   |     white
  --color-for-calendar-selected-range   |  Selected dates range border color               |     #4CB050
  --background-img-for-selected-date    |  Background image for selected dates             |     url('../t-input-date-picker/Green circle.svg')                                                                 
  --background-img-for-today-date       |  Background image for today's date               |     url('../t-input-date-picker/todayCircle.svg')

Note:
The form handles below mentioned scenarios on its own.

1. You can't search for past dates.
2. Minimum booking date difference is 1 day ie: user have to book hotel atleast for a day so check out date is always greater than check in.
3. A minimum of 1 adult is required to book a hotel.
4. Children are considered below 12yrs old.
5. Child age is mandatory.


@demo demo/index.html
-->


<dom-module id="t-search">
  <template>
    <style include="t-search-style">

    </style>
    <br/>

    <iron-media-query query="(max-width: 380px)" query-matches="{{smallMobileView}}"></iron-media-query>
    <iron-media-query query="(min-width: 380px) and (max-width:767px)" query-matches="{{mobileView}}"></iron-media-query>
    <iron-media-query query="(min-width: 768px) and (max-width:1023px)" query-matches="{{tabletView}}"></iron-media-query>
    <iron-media-query query="(min-width: 1024px) and (max-width: 1200px)" query-matches="{{desktopView}}"></iron-media-query>
    <iron-media-query query="(min-width: 1200px)" query-matches="{{largeDesktopView}}"></iron-media-query>
    <iron-media-query query="(max-width: 600px)" query-matches="{{mediumTablet}}"></iron-media-query>
    <iron-media-query query="(max-width: 767px)" query-matches="{{mobilePhone}}"></iron-media-query>

    <div class="item" smallMobileView$="{{smallMobileView}}" desktopView$="{{desktopView}}" tabletView$="{{tabletView}}" mobileView$="{{mobileView}}"
      largeDesktopView$="{{_largeDesktopViewOther(largeDesktopView)}}" largeDesktopViewIE$="{{_largeDesktopViewIE(largeDesktopView)}}">


      <div class="container-fluid">
        <div class="row">

          <!--Toolbar to show on mobile screen for Drop down link 'Need more rooms or have children' .
          This is hidden while user is working desktop mode or tablet mode.
          It will come in picture after user clicking on 'Need more rooms or have children' mobile screen..       -->

          <app-toolbar hidden$="{{showToolbar}}" id="toolbarRoom" class="row-lg-height row-md-height row-sm-height row-xs-height">
            <iron-icon icon="icons:arrow-back" id="backButtonRoom" on-tap="_showDPMainToolbar"></iron-icon>
            <paper-button toggles id="buttons" on-tap='_doneRoomCard'>Done</paper-button>
          </app-toolbar>

          <!--Toolbar to show on mobile screen for datepicker.
          This is hidden while user is working desktop mode or tablet mode.
          It will come in picture after user clicking on datepicker at mobile screen.       -->

          <app-toolbar hidden$="{{showDatePicker}}" id="toolbarDatePicker" class="row-lg-height row-md-height row-sm-height row-xs-height">
            <div id="selectDate">
              <iron-icon icon="icons:arrow-back" id="backButtonDatepicker" on-tap="_showDateToolbar"></iron-icon>
              <span class="dateSpan" disabled>Select Dates</span>
              <paper-button toggles id="buttons" on-tap='_doneDatePicker'>Done</paper-button>
            </div>
          </app-toolbar>


          <!--Toolbar to show on mobile screen for Auto suggest.
            This is hidden while user is working desktop mode or tablet mode.
            It will come in picture after user providing three input characters at autosuggest at mobile screen.       -->

          <app-toolbar hidden class="row-lg-height row-md-height row-sm-height row-xs-height" id="toolbarAutoComplete">
            <iron-icon id="backButtonAutoSuggest" icon="icons:arrow-back" on-tap="_showACMainToolbar"></iron-icon>
            <div>
              <iron-icon id="clearButton" icon="close" on-click="_clearInput"></iron-icon>
            </div>
          </app-toolbar>


          <!--Main toolbar which contains auto suggest dropdown, datepickers and travellers drop down at all screens. -->
          <app-toolbar id="mainToolbar" class="row-lg-height row-md-height row-sm-height row-xs-height">
            <form is="iron-form" id="form" method="post" action="/form/handler">
              <div required auto-validate class="col-lg-5 col-md-5 col-sm-12 col-xs-12" id="deskinput">
                <t-autosuggest required auto-validate id="location" name="location" selected-item="{{location}}" query-params="token={{tokenResponse.authenticationToken}}"
                  label="{{hotelLocation}}" token-param="formattedAddress" data-url$="{{dataUrl}}">
                </t-autosuggest>
              </div>


              <div id="start1" class="col-lg-1 col-md-1 col-sm-3 col-xs-6">
                <t-input-date-picker required auto-validate error-message="{{checkInError}}" class="suggestions" date-format="MM/DD/YYYY"
                  id="start" label="{{checkin}}" min-date="[[minDateToday]]" max-date="[[maxDate]]" on-tap="_openDatePicker">
                </t-input-date-picker>
              </div>

              <div id="end1" class="col-lg-1 col-md-1 col-sm-3 col-xs-6">
                <t-input-date-picker required auto-validate error-message="{{checkOutError}}" class="suggestions" id="end" label="{{checkout}}"
                  date-format="MM-DD-YYYY" max-date="[[maxDate]]" on-tap="_openDatePicker">
                </t-input-date-picker>
              </div>

              <div class="col-lg-3 col-md-3 col-sm-4 col-xs-12" id="travellField">
                <paper-dropdown-menu on-tap="_dismisCard" required auto-validate error-message="Required Field" class="suggestions" id="deskinput1"
                  readonly on-keydown="_tabPress">
                  <paper-listbox class="dropdown-content" id="listbox" selected="{{choice}}">
                    <template is='dom-repeat' items='{{choices}}'>
                      <paper-item class="trvellerItem" id="adult{{item.adult}}Room1" count-adult$="{{item.adult}}" count-room$="{{item.room}}"
                        value="{{item}}">{{item.adult}} {{_adultLabel(item.adult)}} in {{item.room}} {{_roomLabel(item.room)}}</paper-item>
                    </template>
                    <paper-item on-tap="_openChildForm" id="needRoom" class="trvellerItem">Need more rooms or have children? </paper-item>
                  </paper-listbox>
                </paper-dropdown-menu>
                <input id="travellerInput" is="iron-input" type="hidden" bind-value="[[choice]]">
              </div>

              <div id="Button" class="col-lg-1 col-md-1 col-sm-2 col-xs-12 text-center">
                <paper-button on-tap="_submitSearchFormInput" class="button" id="button">Search</paper-button>
              </div>

            </form>
          </app-toolbar>
        </div>
      </div>
    </div>
    <div class="item" id="card" smallMobileView$="{{smallMobileView}}" MobileView$="{{mobileView}}" TabletView$="{{tabletView}}"
      DesktopView$="{{desktopView}}" largeDesktopView$="{{largeDesktopView}}">
      <paper-card hidden$="{{showTravellersCard}}" id="paperCard" class="paperCard">
        <div>
          <choice-card id="choiceCard" roomLabel="{{room}}"></choice-card>
        </div>
      </paper-card>
    </div>
  </template>

  <script>
    var mqu = false, mq = false, mql = false, doneStartDate, doneEndDate;
    Polymer({
      is: 't-search',
      properties: {
        /**
        * This contain search form to search a hotel based on location, check-in date, check-out date and travellers.
        */

        /**
         * This property should have the value of a compatible autosuggest api url.
         * Autosuggest api should return valid options based on a GET call to this url after appending `'/{text entered in location field}?{queryParams}'`
         * Suggestions are requested after 3 characters(configurable) have been entered. 
         */
        dataUrl: String,

        /**        
         * This property stores the value of autosuggest api query parameters. 
         * @private
         */
        queryParams: String,
        /**
         * This property stores the value of authentication token required for autosuggest API. 
         */
        tokenResponse: String,

        /**        
        * To toggle travellers form.
        *@private
        */

        showTravellersCard: {
          type: Boolean,
          value: true
        },

        /**
         * Property to set iron media queries for medium tablet.
         *@private
         **/
        mediumTablet: {
          type: Boolean,
          value: false
        },
        /**
         * Property to set iron media queries for tablet.         
         *@private
         **/
        tabletView: {
          type: Boolean,
          value: false
        },
        /**
         * Property to set iron media queries for mobilephone.
         *@private
         **/
        mobilePhone: {
          type: Boolean,
          value: false
        },
        /**
         * Property to toggle toolbar of travellers field for mobile view.
         *@private
         **/
        showToolbar: {
          type: Boolean,
          value: true
        },
        /**
         * Property to toggle toolbar of datepicker field for mobile view.
         *@private
         **/
        showDatePicker: {
          type: Boolean,
          value: true
        },
        /**
        *t-autosuggest location property.
        *@private
        **/
        location: String,

        /**
        *return the min date of checkin date as today
        */

        minDateToday: {
          type: Date
        },

        /**
        *this property holds selected item of travellers dropdown and used for binding to input.
        *@private
        **/

        choice: {
          type: String,
          value: 0
        },
        /**
        *@private
        **/
        choices: {
          type: Array
        },
        /**
        *@private
        **/
        checkInAllowFromNow: {
          type: Number,
          value: 0
        },
        /**
        *@private
        **/
        minAdultCount: {
          type: Number,
          value: 2
        },
        /**
        *@private
        **/
        maxAdultCount: {
          type: Number,
          value: 6
        },
        /**
        *@private
        **/
        minChildCount: {
          type: Number,
          value: 0
        },
        /**
        *@private
        **/
        maxChildCount: {
          type: Number,
          value: 5
        },
        /**
        *@private
        **/
        minChildAge: {
          type: Number,
          value: 1
        },
        /**
        *@private
        **/
        maxChildAge: {
          type: Number,
          value: 7
        },
        /**
        *@private
        **/
        totalRoomPaxCount: {
          type: Number,
          value: 6
        },
        /**
        *@private
        **/
        maxRoomCount: {
          type: Number,
          value: 2
        },
        /**
        *@private
        **/
        defaultAdultCount: {
          type: Number,
          value: 0
        },
        /**
        *@private
        **/
        defaultChildCount: {
          type: Number,
          value: 0
        },
        /**
        *@private
        **/
        maxStayDuration: {
          type: Number,
          value: 30
        },
        /**
        *@private
        **/
        defaultStayDuration: {
          type: Number,
          value: 4
        },

        format: {
          type: String,
          value: "MM/DD/YYYY"
        },
        /**
        *@private
        **/
        defaultSelectOption: {
          type: Object,
          value: [{
            "room": 1,
            "adult": 1
          }, {
            "room": 1,
            "adult": 2
          }, {
            "room": 1,
            "adult": 3
          }, {
            "room": 2,
            "adult": 5
          }]
        },

        /**
        Labels
        **/
        /**
        *@private
        **/
        adult: {
          type: String,
          value: "Adult"
        },
        /**
        *@private
        **/
        adults: {
          type: String,
          value: "Adults"
        },
        /**
        *@private
        **/
        room: {
          type: String,
          value: "Room"
        },
        /**
        *@private
        **/
        rooms: {
          type: String,
          value: "Rooms"
        },
        /**
        *@private
        **/
        childLabel: {
          type: String,
          value: "Children"
        },
        /**
        *@private
        **/
        child: {
          type: String,
          value: "Child"
        },
        /**
        *@private
        **/
        age: {
          type: String,
          value: "Age"
        },
        /**
        *@private
        **/
        travelers: {
          type: String,
          value: "Travellers"
        },
        /**
        *@private
        **/
        checkin: {
          type: String,
          value: "Check in"
        },
        /**
        *@private
        **/
        checkout: {
          type: String,
          value: "Check out"
        },
        /**
        WaterMark
        **/
        /**
        *@private
        **/
        checkIn: {
          type: String,
          value: "MM/DD/YY"
        },
        /**
        *@private
        **/
        checkOut: {
          type: String,
          value: "MM/DD/YY"
        },
        /**
        *@private
        **/
        hotelLocation: {
          type: String,
          value: "Search by Airport, Destination etc."
        },
        /**
        *@private
        **/
        HotelLocation: {
          type: String,
          value: "City, Airport, Address or Point of Interest"
        },
        /**
        *@private
        **/
        destinationError: {
          type: String,
          value: "Please enter your destination"
        },
        /**
        *@private
        **/
        checkInError: {
          type: String,
          value: "Please enter checkin date"
        },
        /**
        *@private
        **/
        checkOutError: {
          type: String,
          value: "Please enter checkout date"
        },

        /**
         * This property is used to set search option.
         **/
        option: {
          type: Object,
          value: {
            "traveller": {

              "defaultSelectOption": []

            },
            "date": {
            }
          }
        },
        /**
         * This property is used to set search localized resources.
         **/
        resources: {
          type: Object,
          value: {
            "labels": {
            },
            "watermark": {
            },

            "errorMessage": {
            }
          }
        },
        /**
         * Property to collect output data after done button is clicked in travellers form.
         *@private
         **/
        doneRoomCardOutput: {
          type: String
        },
        /**
         * Property to ensure whether done button of travellers toolbar for mobile view is clicked or not.
         *@private
         **/
        doneRoomCard: {
          type: Boolean,
          value: false
        },
        /**
         * Property to ensure whether done button of datepicker toolbar for mobile view is clicked or not.
         *@private
         **/
        doneDatePicker: {
          type: Boolean,
          value: false
        },

        /**
        *Maximum date user can select for checkin datepicker.
        *Default is after 1 year.           
        *Date format is mm/dd/yyyy.
        **/

        maxDate: {
          type: Date,
          value: function () {
            var x = 12; //or whatever offset
            var dateAfterOneYear = new Date();
            dateAfterOneYear.setMonth(dateAfterOneYear.getMonth() + x);
            return dateAfterOneYear;
          }
        },

        /**
         * Property to get the JSON object of destiantion field output with others parameters like name, geoCode, etc.
         * It is used in searchModel JSON object.
         *@private
         **/
        dataCity: {
          type: Array
        },
        /**
         * Property holds array of travellers output.
         * This property get output for choice card.
         * It is used in searchModel JSON object.
         *@private 
         **/
        travellersFinalData: {
          type: Array
        }
      },

      _adultLabel: function (adultCount) {
        if (adultCount <= 1) {
          return this.adult;
        }
        else {
          return this.adults;
        }
      },
      _roomLabel: function (roomCount) {
        if (roomCount <= 1) {
          return this.room;
        }
        else {
          return this.rooms;
        }
      },

      _choices: function () {
        var childArray = new Array();
        var maximumChild = this.defaultSelectOption.length;
        for (i = 0; i < maximumChild; i++) {
          var dropDownOption = this.defaultSelectOption[i].room;
          if (dropDownOption <= this.maxRoomCount) {
            childArray.push(this.defaultSelectOption[i]);
          }
        }
        this.choices = childArray;
        return childArray;
      },

      /**
       * This function is used to set min date for check in datepicker.
       * It returns the min date as today.
       **/
      _setMinDate: function (checkInAllowFromNow) {
        var setMinDatetoToday = new Date();
        setMinDatetoToday.setDate(setMinDatetoToday.getDate() - 1 + checkInAllowFromNow);
        this.minDateToday = setMinDatetoToday;
        return setMinDatetoToday;
      },


      /**
       * Function to set view of internet explorer.       
       * */
      _largeDesktopViewIE: function (largeDesktopView) {
        // Internet Explorer 6-11
        var isIE = /*@cc_on!@*/false || !!document.documentMode;
        return isIE && largeDesktopView;
      },
      /**
       * Function for desktop view for browsers other than internet explorer.
       * */
      _largeDesktopViewOther: function (largeDesktopView) {
        // Internet Explorer 6-11
        var isIE = /*@cc_on!@*/false || !!document.documentMode;
        return !isIE && largeDesktopView;
      },
      /**
      *to hide the travellers form on blur.
      **/

      _dismisCard: function () {
        var travellerLabelShow = this.$$("#deskinput1");
        var tabsView = window.matchMedia("(min-width:768px) and (max-width:1190px)").matches;
        if (tabsView) {
          travellerLabelShow.querySelector("#input").style.fontSize = "13px";
        }

        travellerLabelShow.label = this.travelers;
        travellerLabelShow.querySelector("[id^='paper-input-label']").style.color = "lightgray";
        var pCard = Polymer.dom(this.$.paperCard).node;
        pCard.style.display = 'none';
        var paperItem = this.$$("#needRoom");
        paperItem.textContent = "Need more rooms or have children?";
        this.querySelector("#deskinput1").blur();
      },
      /**
       * This function is used for up and down arrow key press on drop down menu.
       **/
      _tabPress: function (e) {
        if (e.keyCode == 38 || e.key == "ArrowDown") {
          var pCard = Polymer.dom(this.$.paperCard).node;
          pCard.style.display = 'none';
          var paperItem = this.$$("#needRoom");
          paperItem.textContent = "Need more rooms or have children?";
        }
      },
      /**
      * Function to open full screen calendar dialog at mobile screen.
      **/
      _openDatePicker: function () {
        var startInput = Polymer.dom(this.$.start).node;
        var endInput = Polymer.dom(this.$.end).node;
        if (mq) {
          this.$.end.invalid = false;
          Polymer.dom(this.$.toolbarDatePicker).node.style.display = "block";
          Polymer.dom(this.$.deskinput).node.style.display = "none";
          Polymer.dom(this.$.travellField).node.style.display = "none";
          Polymer.dom(this.$.Button).node.style.display = "none";
          Polymer.dom(this.$.mainToolbar).node.style.height = "0px";
          Polymer.dom(this.$.mainToolbar).node.style.minHeight = "0px";
          Polymer.dom(this.$.start1).node.classList.add("divColorofDatepicker");
          Polymer.dom(this.$.end1).node.classList.add("divColorofDatepicker");
          Polymer.dom(this.$.mainToolbar).node.classList.add("divColorofDatepicker");
          startInput.children[0].style.textAlign = "center";
          endInput.children[0].style.textAlign = "center";
          startInput.querySelector("#input").querySelector("#input").style.color = "black";
          endInput.querySelector("#input").querySelector("#input").style.color = "black";
        }
        var tabView = window.matchMedia("(min-width:768px) and (max-width:1190px)").matches;
        if (tabView) {
          startInput.querySelector("#input").querySelector("#input").style.fontSize = "13px";
          endInput.querySelector("#input").querySelector("#input").style.fontSize = "13px";
        }
        if (this.showTravellersCard == true) {
          this.showTravellersCard = !this.showTravellersCard
        }
        if (mq && this.showDatePicker == true) {
          this.showDatePicker = !this.showDatePicker;
        }
      },

      /**
      *To open the travellers form on click of 'need more rooms or have children'.      
      **/

      _openChildForm: function (e) {
        if (mq) {
          this.querySelector("#start1").style.display = "none";
          this.querySelector("#end1").style.display = "none";
          this.querySelector("#deskinput").style.display = "none";
          this.querySelector("#deskinput1").style.display = "none";
          this.querySelector("#Button").style.display = "none";
        }
        this.$.needRoom.textContent = "1 Adult in 1 Room";
        var pCard = Polymer.dom(this.$.paperCard).node;
        pCard.style.display = 'block';
        pCard.style.top = this.$.deskinput1.getBoundingClientRect().bottom+'px'; // Set dynamic top position

        if (this.showTravellersCard == true) {
          this.showTravellersCard = !this.showTravellersCard
        }
        pCard.style.visibility = '' ? 'hidden' : '';

        var tBar = Polymer.dom(this.$.toolbarRoom).node;
        tBar.style.display = 'block';
        var toolbarSpan = this.querySelector("#choiceCard").querySelector("#choiceRoom");
        this.choice = this.choices.length;
        toolbarSpan._calResultOfRoom();
        if (mq && this.showToolbar == true) {
          this.showToolbar = !this.showToolbar;
        }
        tBar.style.visibility = '' ? 'hidden' : '';
        if (mq) {
          this.querySelector("#toolbarRoom");
        }
        var Choicecard = this.querySelector("#choiceCard");
        Choicecard.querySelector("#button1").style.visibility = "visible";
        if (Choicecard.roomCount >= this.maxRoomCount) {
          Choicecard.querySelector("#button1").style.visibility = "hidden";
        }
      },
      /**
      * Function called upon done button click for travellers form on mobile screen.
      **/

      _doneRoomCard: function () {
        this.doneRoomCard = true;
        var card = this.querySelector("#choiceCard");
        var validData = card._doneRoom();
        this.querySelector("#menuButton").querySelector("#input").value = this.doneRoomCardOutput;
        if (validData == true) {
          this._styleForBackToMainToolbar();
          Polymer.dom(this.$.toolbarRoom).node.style.display = "none";
          this.querySelector("#paperCard").style.display = "none";
          return true;
        }
        else {
          validData = false;
        }
      },
      /**
       * Supportive function to maintain style when displayed main screen in mobile view. 
       * */
      _styleForBackToMainToolbar: function () {
        this.querySelector("#start1").style.display = "block";
        this.querySelector("#end1").style.display = "block";
        this.querySelector("#deskinput").style.display = "block";
        this.querySelector("#deskinput1").style.display = "block";
        this.querySelector("#Button").style.display = "block";
      },


      /**
      * Function called upon done button click for calendar on mobile screen.
      **/
      _doneDatePicker: function () {
        var startDialog = this.querySelector("#start");
        var endDialog = this.querySelector("#end");
        startDialog.querySelector("#dialog").style.display = "none";
        endDialog.querySelector("#dialog").style.display = "none";
        startDialog.querySelector(".underline").style.border = "none";
        endDialog.querySelector(".underline").style.border = "none";
        this.doneDatePicker = true;
        this._showDateToolbarFun();
        doneStartDate = startDialog.value;
        doneEndDate = endDialog.value;
      },
      /**
      * This function will work after clicking on back button on travellers toolbar in mobile screen.
      **/
      _showDPMainToolbar: function () {
        if (mq) {
          this._styleForBackToMainToolbar();
        }
        var paperItem = this.$$("#needRoom");
        paperItem.textContent = "Need more rooms or have children?";
        this.showTravellersCard = true;
        this.showToolbar = true;
        Polymer.dom(this.$.toolbarDatePicker).node.style.display = "none";
        Polymer.dom(this.$.deskinput).node.style.display = "block";
        Polymer.dom(this.$.deskinput1).node.style.display = "block";
        Polymer.dom(this.$.button).node.style.display = "block";
        Polymer.dom(this.$.start1).node.classList.add("colorOfToolbarAtRuntime");
        Polymer.dom(this.$.end1).node.classList.add("colorOfToolbarAtRuntime");
        Polymer.dom(this.$.mainToolbar).node.classList.add("colorOfToolbarAtRuntime");
        this.choice = 0;
        var dropdownInput = this.querySelector("#deskinput1").querySelector("#menuButton").domHost.querySelector("#input");
        if (this.doneRoomCard == false && this.doneRoomCardOutput == null) {
          dropdownInput.value = "1 Adult in 1 Room";
        } else if (this.doneRoomCard == true && this.doneRoomCardOutput == undefined) {
          dropdownInput.value = "1 Adult in 1 Room";
        } else if (this.doneRoomCardOutput != null) {
          dropdownInput.value = this.doneRoomCardOutput;
        }
      },

      /**
       * It display the main toolbar after clicking on back button for datepicker in mobile view.
       **/
      _showDateToolbar: function () {
        this._showDateToolbarFun();
        var startDateValue = this.querySelector("#start");
        var endDateValue = this.querySelector("#end");
        if (this.doneDatePicker == false && doneStartDate == null && doneEndDate == null) {
          startDateValue.value = undefined;
          startDateValue.placeholder = "";
          endDateValue.value = undefined;
          endDateValue.placeholder = "";
        } else if (doneStartDate != null && doneEndDate != null) {
          startDateValue.value = doneStartDate;
          endDateValue.value = doneEndDate;
        }
        endDateValue.querySelector(".underline").style.border = "none";
        startDateValue.querySelector(".underline").style.border = "none";
        startDateValue.querySelector("#dialog").style.display = "block";
        if (startDateValue.value === undefined) {
          this.querySelector("#calendar").children[0].scrollTop = 0;
        }
        startDateValue.querySelector("#dialog").style.display = "none";
        endDateValue.querySelector("#dialog").style.display = "none";
      },

      /**
       * This is supportive function to maintain style of datepicker toolbar in mobile view.
       **/
      _showDateToolbarFun: function () {
        this.showTravellersCard = true;
        this.showToolbar = true;
        Polymer.dom(this.$.toolbarDatePicker).node.style.display = "none";
        Polymer.dom(this.$.deskinput).node.style.display = "block";
        Polymer.dom(this.$.travellField).node.style.display = "block";
        Polymer.dom(this.$.Button).node.style.display = "block";
        Polymer.dom(this.$.start1).node.classList.remove("divColorofDatepicker");
        Polymer.dom(this.$.end1).node.classList.remove("divColorofDatepicker");
        Polymer.dom(this.$.mainToolbar).node.classList.remove("divColorofDatepicker");
        Polymer.dom(this.$.start1).node.classList.add("colorOfToolbarAtRuntime");
        Polymer.dom(this.$.end1).node.classList.add("colorOfToolbarAtRuntime");
        Polymer.dom(this.$.mainToolbar).node.classList.add("colorOfToolbarAtRuntime");
        var startInput = Polymer.dom(this.$.start).node;
        var endInput = Polymer.dom(this.$.end).node;
        startInput.children[0].style.textAlign = "";
        endInput.children[0].style.textAlign = "";
        startInput.querySelector(".unfocused-line").style.display = "block";
        endInput.querySelector(".unfocused-line").style.display = "block";
        startInput.querySelector("#labelAndInputContainer").style.marginRight = "";
        endInput.querySelector("#labelAndInputContainer").style.marginRight = "";
        startInput.querySelector("#input").querySelector("#input").style.color = "white";
        endInput.querySelector("#input").querySelector("#input").style.color = "white";
      },
      /**
       * This function will work after clicking on back button on autocomplete toolbar in mobile screen.
       **/

      _showACMainToolbar: function () {
        this.querySelector("#autoSuggest").placeholder = "";
        this.querySelector("#location").label = this.hotelLocation;
        this.showTravellersCard = true;
        this.showToolbar = true;
        Polymer.dom(this.$.toolbarAutoComplete).node.style.display = "none";
        this._styleForBackToMainToolbar();
        this.querySelector("#travellField").style.display = "block";
        this.querySelector("#dropBox").style.display = "none";
      },
      /**
      *Function to clear autocomplete toolbar content when clicked on clear button for mobile screen.
      **/
      _clearInput: function () {
        var autoInput = this.querySelector("#spanAutoId");
        autoInput.value = "";
        autoInput.focus();
        var node = this.querySelector("#dropBox");
        while (node.hasChildNodes()) {
          node.removeChild(node.lastChild);
        }
        /*Dummy blank ul to create mobile view on click of clear button */
        var toolbar = this.querySelector("#toolbarAutoComplete");
        var ul = domCreate("ul");
        toolbar.style.display = "block";
        toolbar.hidden = false;
        var inPut = toolbar.childNodes[2];
        node.appendChild(ul);
        attrClass(ul, "ulClassMobile");
      },

      _defaultOptionValue: function () {
        if (this.option.traveller === undefined) {
          this.defaultSelectOption;
          this.defaultChildCount;
          this.defaultAdultCount;
          this.totalRoomPaxCount;
          this.minAdultCount;
          this.maxAdultCount;
          this.minChildCount;
          this.maxChildCount;
          this.minChildAge;
          this.maxChildAge;
        }
        else {
          if (this.option.traveller.defaultSelectOption){
            this.defaultSelectOption = this.option.traveller.defaultSelectOption;
          }
          if (this.option.traveller.defaultChildCount){
            this.defaultChildCount = this.option.traveller.defaultChildCount;
          }
          if (this.option.traveller.defaultAdultCount){
            this.defaultAdultCount = this.option.traveller.defaultAdultCount;
          }
          if (this.option.traveller.totalRoomPaxCount){
            this.totalRoomPaxCount = this.option.traveller.totalRoomPaxCount;
          }
          if (this.option.traveller.minAdultCount ){
            this.minAdultCount = this.option.traveller.minAdultCount;
          }
          if (this.option.traveller.maxAdultCount){
            this.maxAdultCount = this.option.traveller.maxAdultCount;
          }
          if (this.option.traveller.minChildCount){
            this.minChildCount = this.option.traveller.minChildCount;
          }
          if (this.option.traveller.maxChildCount){
            this.maxChildCount = this.option.traveller.maxChildCount;
          }
          if (this.option.traveller.minChildAge ){
            this.minChildAge = this.option.traveller.minChildAge;
          }
          if (this.option.traveller.maxChildAge){
            this.maxChildAge = this.option.traveller.maxChildAge;
          }
        }
        if (this.option.date === undefined) {
          this.checkInAllowFromNow;
          this.maxStayDuration;
          this.defaultStayDuration;
          this.format;
        }
        else {
          if (this.option.date.checkInAllowFromNow){
            this.checkInAllowFromNow = this.option.date.checkInAllowFromNow;
          }
          if (this.option.date.maxStayDuration){
            this.maxStayDuration = this.option.date.maxStayDuration;
          }
          if (this.option.date.defaultStayDuration){
            this.defaultStayDuration = this.option.date.defaultStayDuration;
          }
          if (this.option.date.format){
            this.format = this.option.date.format;
          }
        }
        if (this.option.maxRoomCount){
          this.maxRoomCount = this.option.maxRoomCount;
        }

      },

      _defaultResourcesValue: function () {
        /**Labels**/
        if (this.resources.labels === undefined) {
          this.adult;
          this.adults;
          this.room;
          this.rooms;
          this.childLabel;
          this.child;
          this.age;
          this.travelers;
          this.checkin;
          this.checkout;
          this.hotelLocation;
        }
        else {
          if (this.resources.labels.adult){
            this.adult = this.resources.labels.adult;
          }
          if (this.resources.labels.adults){
            this.adults = this.resources.labels.adults;
          }
          if (this.resources.labels.room){
            this.room = this.resources.labels.room;
          }
          if (this.resources.labels.rooms){
            this.rooms = this.resources.labels.rooms;
          }
          if (this.resources.labels.children){
            this.childLabel = this.resources.labels.children;
          }
          if (this.resources.labels.child){
            this.child = this.resources.labels.child;
          }
          if (this.resources.labels.age){
            this.age = this.resources.labels.age;
          }
          if (this.resources.labels.travelers){
            this.travelers = this.resources.labels.travelers;
          }
          if (this.resources.labels.checkin){
            this.checkin = this.resources.labels.checkin;
          }
          if (this.resources.labels.checkout){
            this.checkout = this.resources.labels.checkout;
          }
          if (this.resources.labels.hotelLocation){
            this.hotelLocation = this.resources.labels.hotelLocation;
          }
          if (this.resources.labels.HotelLocation){
            this.HotelLocation = this.resources.labels.HotelLocation;
          }
        }

        /**WaterMark**/
        if (this.resources.watermark === undefined) {
          this.checkIn;
          this.checkOut;
        }
        else {
          if (this.resources.watermark.checkIn){
            this.checkIn = this.resources.watermark.checkIn;
          }
          if (this.resources.watermark.checkOut ){
            this.checkOut = this.resources.watermark.checkOut;
          }
        }
        if (this.resources.errorMessage === undefined) {
          this.destinationError;
          this.checkInError;
          this.checkOutError;
        }
        else {
          if (this.resources.errorMessage.destinationError){
            this.destinationError = this.resources.errorMessage.destinationError;
          }
          if (this.resources.errorMessage.checkInError){
            this.checkInError = this.resources.errorMessage.checkInError;
          }
          if (this.resources.errorMessage.checkOutError){
            this.checkOutError = this.resources.errorMessage.checkOutError;
          }
        }
      },

      /*
      *To collect the input from form on click of search button.
      *This function also validates each field of the form.
      * And used to set search button text as 'searching'.
      */

      _submitSearchFormInput: function (e) {
        var txtStart = this.querySelector("#start"),
            txtEnd = this.querySelector("#end");
        var data = [];
        data[0] = this.querySelector("#autoSuggest").value;
        data[1] = txtStart.value;
        data[2] = txtEnd.value;
        data[3] = this.querySelector("#menuButton").querySelector("#input").value;
        
        if (data[0] == "" && data[1] == undefined && data[2] == undefined) {
          this.querySelector("#autoInput").invalid = true;
          this.$.start.invalid = true;
          this.$.end.invalid = true;
          txtStart.querySelector("[id^='paper-input-label']").style.color = "lightgray";
          txtEnd.querySelector("[id^='paper-input-label']").style.color = "lightgray";
        }
        else if (data[1] == undefined && data[2] == undefined) {
          this.$.start.invalid = true;
          this.$.end.invalid = true;
          txtStart.querySelector("[id^='paper-input-label']").style.color = "lightgray";
          txtEnd.querySelector("[id^='paper-input-label']").style.color = "lightgray";
        }
        else if (data[0] == "") {//show error        
          this.querySelector("#autoInput").invalid = true;
        }
        else {
          var card = this.querySelector("#choiceCard");
          var totalDDOption = this.defaultSelectOption.length;
          if (this.choice >= 0 && this.choice < totalDDOption) {
            var roomC = this.querySelector("#choiceCard").roomCount;
            for (var i = 0; i < roomC; i++) {
              this.querySelectorAll("#choiceRoom")[i].querySelector(".inputChildCount").querySelector("#listBox").selected = 0;
              this.querySelectorAll("#choiceRoom")[i].querySelector(".inputAdultCount").querySelector("#listBox").selected = 0;
            }
          }
          var validData = card._doneRoom();
          if (validData == true) {
            this.$.button.textContent = 'searching';
            var searchModel = {};
            searchModel.destination = this.dataCity;
            searchModel.checkIn = txtStart.querySelector("#input").value;
            searchModel.checkOut = txtEnd.querySelector("#input").value;
            searchModel.rooms = [];
            

            for (var i = 0; i < this.travellersFinalData.length; i++) {
              var tinfo =JSON.parse(this.travellersFinalData[i]);
              var obj ={};
              tinfo.forEach(trav=>{
                   if(trav[0]){
                     var traveler = {
                            qty : trav[0],
                            ages : trav[2]
                        };
                      if(trav[1]=="Adult"){
                        obj.adult = traveler;
                      }
                      else if(trav[1]=="Child"){
                        obj.children = traveler;
                      }
                   }
              });
              searchModel.rooms.push(obj);
            }
           
            searchModel.type = "Hotel";
            this.fire('dosearch', { model: searchModel });
            console.log(searchModel);
            return false;      // stop form from posting
          }
          else {
            this._openChildForm(e);
          }
        }
      },

      /* 
      * function to control datepicker for checkin and checkout dates.
      */
      ready: function () {
        this._defaultOptionValue();
        this._defaultResourcesValue();
        var ckeckMin = this.checkInAllowFromNow;
        this._setMinDate(ckeckMin);
        var travelDD = this.defaultSelectOption;
        this._choices(travelDD);
        mqu = this.mediumTablet;
        mq = this.mobilePhone;
        mql = this.tabletView;
        var start = this.$$('#start');
        var end = this.$$('#end');
        var CurrentDate;
        start.addEventListener('value-changed', function () {
          // Open the end datepicker with a delay to
          // make it less confusing.
          window.setTimeout(function () {
            startDate = new Date();
            startDate.setDate(startDate.getDate() - 1);
            start.minDate = startDate;
            CurrentDate = start.value;
            if (CurrentDate != undefined) {
              CurrentDate.setHours(0, 0, 0, 0);
              CurrentDate.setDate(CurrentDate.getDate());
            }
            if (start.value > end.value) {
              end.value = CurrentDate;
            }
          });
        });

        var travelLableColor = this.$$("#deskinput1");
        travelLableColor.querySelector("#input").style.color = "lightgray";
        var deskView = window.matchMedia("(min-width:1024px) and (max-width:1260px)").matches;
        if (deskView) {
          var travellerDD = this.$$("#deskinput1").children[1].children[1];
          travellerDD.style.width = "120%";
          travellerDD.style.marginTop = "5px";
        }
        if (mql) {
          var inputContent = this.$$("#deskinput1").children[1].children[1];
          inputContent.style.width = "120%";
        }
      },
    });
  </script>
</dom-module>